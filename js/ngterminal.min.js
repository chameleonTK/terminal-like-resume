angular.module("ngterminal",[]),angular.module("ngterminal").factory("Command",["$q",function(e){function n(e,n){if(n.length>0){if(n[0].length>0&&"-"==n[0][0])var t=n[0].split("").find(function(e){return"a"==e}),i=n[0].split("").find(function(e){return"l"==e});var u=n.find(function(e){return e.length>0&&"-"!=e[0]});if(u){if(console.log(u,n[n.length-1]),u!=n[n.length-1])return{successful:!1,messages:["ls: Not support list multiple files"]};return r.find(function(e){return"folder"==e.type&&e.name==u})?{successful:!0,messages:[]}:{successful:!1,messages:["ls: "+u+": No such file or directory"]}}}if(i){var s=r.reduce(function(e,n){for(var t=n.size;t.length<6;)t=" "+t;return"folder"==n.type?e.push("drw-r--r--   1 imtk  imtk       "+t+" Mar 10 00:00 "+n.name):e.push("-rw-r--r--   1 imtk  imtk       "+t+" Mar 10 00:00 "+n.name),e},[]);return{successful:!0,messages:s}}if(t){var s=r.reduce(function(e,n){return e.push(n.name),e},[]);return{successful:!0,messages:s}}var l=Math.ceil(r.length/2),s=r.reduce(function(e,n,t){if(t<l)e.push(n.name);else{for(;e[t-l].length<14;)e[t-l]+=" ";e[t-l]+=n.name}return e},[]);return{successful:!0,messages:s}}function t(t,r){return e(function(e,i){switch(t){case"ls":return e(n(t,r)),!0;default:return e({successful:!1,messages:["-bash: "+t+": command not found"]}),!1}})}var r=[{name:"blog",type:"folder",size:"29k"},{name:"contact.txt",type:"file",size:"32"},{name:"profile.txt",type:"file",size:"2"},{name:"twitter",type:"folder",size:"430"},{name:"README.md",type:"file",size:"3723"}];return{execute:t}}]),angular.module("ngterminal").directive("terminal",["$sce","$q","$interval","$document","$timeout","$location","$anchorScroll","Command",function(e,n,t,r,i,u,s,l){var a=this;return{scope:{},templateUrl:"templates/terminal.html",link:function(c){function o(){return a.options.terminal_name+":~$ "}function f(){c.plainText.push(""),c.lines.push(""),a.currentIndex++,x(a.currentIndex)}function m(e){e.reduce(function(e,n){return e.then(function(){return d(n)})},n.resolve()).then(function(){return d(o(),!0)})}function d(e,r){return a.typerAviable=!1,n(function(n,i){var u=0;t(function(){p(e[u]),++u>=e.length&&(r||f(),a.typerAviable=!0,n())},a.options.write_delay,e.length)})}function p(n){c.plainText[a.currentIndex]+=g(n),c.lines[a.currentIndex]=e.trustAsHtml(c.plainText[a.currentIndex])}function h(n){var t=c.plainText[a.currentIndex];if(!n&&t.length<=a.options.terminal_name.length+9)return!1;if(";"==t[t.length-1]){for(;"&"!=t[t.length-1];)t=t.slice(0,-1),c.plainText[a.currentIndex]=t,c.lines[a.currentIndex]=e.trustAsHtml(t);c.plainText[a.currentIndex]=t.slice(0,-1),c.lines[a.currentIndex]=e.trustAsHtml(c.plainText[a.currentIndex])}else c.plainText[a.currentIndex]=t.slice(0,-1),c.lines[a.currentIndex]=e.trustAsHtml(c.plainText[a.currentIndex])}function g(e){switch(e){case" ":return"&nbsp;";case'"':return"&quot;";case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case";":return"&#59;";default:return e}}function x(e){var n="command-"+e;u.hash()!==n?u.hash(n):s()}a.options={write_delay:10,init_text:[],terminal_name:"imtk@curveinth"},a.currentIndex=0,a.writePromise=n.resolve(),a.typerAviable=!1,a.command="",c.plainText=[""],c.lines=[""],function(){var e=new Date,n=a.options.init_text.slice(0);n.push("Last login : "+e.toUTCString()+" on ttys001"),m(n)}(),r.bind("keydown",function(e){switch(e.keyCode){case 8:return a.typerAviable&&i(function(){h(),a.command=a.command.slice(0,-1)}),e.preventDefault(),!0;case 9:return e.preventDefault(),!0;case 13:return a.typerAviable&&i(function(){f();var e=a.command.split(" ").filter(function(e){return e}),n=e.shift();a.typerAviable=!1,l.execute(n,e).then(function(e){m(e.messages)}),a.command=""}),e.preventDefault(),!0;case 38:case 40:return e.preventDefault(),!0;default:return!0}}),r.bind("keypress",function(e){a.typerAviable&&(i(function(){p(e.key),a.command+=e.key}),e.preventDefault())})}}}]);