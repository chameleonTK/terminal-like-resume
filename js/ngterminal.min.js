angular.module("ngterminal",[]),angular.module("ngterminal").factory("Command",[function(){function e(){return""}return{execute:e}}]),angular.module("ngterminal").directive("terminal",["$sce","$q","$interval","$document","$timeout","$location","$anchorScroll","Command",function(e,n,t,r,i,u,a,c){var l=this;return{scope:{},templateUrl:"templates/terminal.html",link:function(o){function s(){return l.options.terminal_name+":~$ "}function m(){o.plainText.push(""),o.lines.push(""),l.currentIndex++,h(l.currentIndex)}function d(e,r){return l.typerAviable=!1,n(function(n,i){var u=0;t(function(){p(e[u]),++u>=e.length&&(r||m(),l.typerAviable=!0,n())},l.options.write_delay,e.length)})}function p(n){o.plainText[l.currentIndex]+=x(n),o.lines[l.currentIndex]=e.trustAsHtml(o.plainText[l.currentIndex])}function f(n){var t=o.plainText[l.currentIndex];if(!n&&t.length<=l.options.terminal_name.length+9)return!1;if(";"==t[t.length-1]){for(;"&"!=t[t.length-1];)t=t.slice(0,-1),o.plainText[l.currentIndex]=t,o.lines[l.currentIndex]=e.trustAsHtml(t);o.plainText[l.currentIndex]=t.slice(0,-1),o.lines[l.currentIndex]=e.trustAsHtml(o.plainText[l.currentIndex])}else o.plainText[l.currentIndex]=t.slice(0,-1),o.lines[l.currentIndex]=e.trustAsHtml(o.plainText[l.currentIndex])}function x(e){switch(e){case" ":return"&nbsp;";case'"':return"&quot;";case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case";":return"&#59;";default:return e}}function h(e){var n="command-"+e;u.hash()!==n?u.hash(n):a()}l.options={write_delay:10,init_text:[],terminal_name:"imtk@curveinth"},l.currentIndex=0,l.writePromise=n.resolve(),l.typerAviable=!1,l.command="",o.plainText=[""],o.lines=[""],function(){var e=new Date,t=l.options.init_text.slice(0);t.push("Last login : "+e.toUTCString()+" on ttys001"),l.writePromise=t.reduce(function(e,n){return e.then(function(){return d(n)})},n.resolve()),l.writePromise.then(function(){return d(s(),!0)}).then(function(){l.typerAviable=!0})}(),r.bind("keydown",function(e){switch(e.keyCode){case 8:return l.typerAviable&&i(function(){f(),l.command=l.command.slice(0,-1)}),e.preventDefault(),!0;case 9:return e.preventDefault(),!0;case 13:return l.typerAviable&&i(function(){m(),d(s(),!0),c.execute(l.command),l.command=""}),e.preventDefault(),!0;case 38:case 40:return e.preventDefault(),!0;default:return!0}}),r.bind("keypress",function(e){l.typerAviable&&(i(function(){p(e.key),l.command+=e.key}),e.preventDefault())})}}}]);