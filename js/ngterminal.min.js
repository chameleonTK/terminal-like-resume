angular.module("ngterminal",[]),angular.module("ngterminal").factory("Command",[function(){function e(){return""}return{execute:e}}]),angular.module("ngterminal").directive("terminal",["$sce","$q","$interval","$document","$timeout","Command",function(e,n,t,r,i,u){var a=this;return{scope:{},templateUrl:"templates/terminal.html",link:function(l){function c(){return a.options.terminal_name+":~$ "}function o(){l.plainText.push(""),l.lines.push(""),a.currentIndex++}function s(e,r){return a.typerAviable=!1,n(function(n,i){var u=0;t(function(){m(e[u]),++u>=e.length&&(r||o(),a.typerAviable=!0,n())},a.options.write_delay,e.length)})}function m(n){l.plainText[a.currentIndex]+=p(n),l.lines[a.currentIndex]=e.trustAsHtml(l.plainText[a.currentIndex])}function d(n){var t=l.plainText[a.currentIndex];if(!n&&t.length<=a.options.terminal_name.length+9)return!1;if(";"==t[t.length-1]){for(;"&"!=t[t.length-1];)t=t.slice(0,-1),l.plainText[a.currentIndex]=t,l.lines[a.currentIndex]=e.trustAsHtml(t);l.plainText[a.currentIndex]=t.slice(0,-1),l.lines[a.currentIndex]=e.trustAsHtml(l.plainText[a.currentIndex])}else l.plainText[a.currentIndex]=t.slice(0,-1),l.lines[a.currentIndex]=e.trustAsHtml(l.plainText[a.currentIndex])}function p(e){switch(e){case" ":return"&nbsp;";case'"':return"&quot;";case"<":return"&lt;";case">":return"&gt;";case"&":return"&amp;";case";":return"&#59;";default:return e}}a.options={write_delay:10,init_text:[],terminal_name:"imtk@curveinth"},a.currentIndex=0,a.writePromise=n.resolve(),a.typerAviable=!1,a.command="",l.plainText=[""],l.lines=[""],function(){var e=new Date,t=a.options.init_text.slice(0);t.push("Last login : "+e.toUTCString()+" on ttys001"),a.writePromise=t.reduce(function(e,n){return e.then(function(){return s(n)})},n.resolve()),a.writePromise.then(function(){return s(c(),!0)}).then(function(){a.typerAviable=!0})}(),r.bind("keydown",function(e){switch(e.keyCode){case 8:return a.typerAviable&&i(function(){d(),a.command=a.command.slice(0,-1)}),e.preventDefault(),!0;case 9:return e.preventDefault(),!0;case 13:return a.typerAviable&&i(function(){o(),s(c(),!0),u.execute(a.command),a.command=""}),e.preventDefault(),!0;case 38:case 40:return e.preventDefault(),!0;default:return!0}}),r.bind("keypress",function(e){a.typerAviable&&(i(function(){m(e.key),a.command+=e.key}),e.preventDefault())})}}}]);